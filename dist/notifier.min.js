(function(b,a,d){function c(f){f=f||{guess:true};var g=f.e||null,i=!!f.guess;var h=new c.implementation(),e=h.run(g);return(i)?h.guessAnonymousFunctions(e):e;}c.implementation=function(){};c.implementation.prototype={run:function(e,f){e=e||this.createException();f=f||this.mode(e);if(f==="other"){return this.other(arguments.callee);}else{return this[f](e);}},createException:function(){try{this.undef();}catch(f){return f;}},mode:function(f){if(f["arguments"]&&f.stack){return"chrome";}else{if(typeof f.message==="string"&&typeof b!=="undefined"&&b.opera){if(!f.stacktrace){return"opera9";}if(f.message.indexOf("\n")>-1&&f.message.split("\n").length>f.stacktrace.split("\n").length){return"opera9";}if(!f.stack){return"opera10a";}if(f.stacktrace.indexOf("called from line")<0){return"opera10b";}return"opera11";}else{if(f.stack){return"firefox";}}}return"other";},instrumentFunction:function(f,h,i){f=f||b;var e=f[h];f[h]=function g(){i.call(this,c().slice(4));return f[h]._instrumented.apply(this,arguments);};f[h]._instrumented=e;},deinstrumentFunction:function(e,f){if(e[f].constructor===Function&&e[f]._instrumented&&e[f]._instrumented.constructor===Function){e[f]=e[f]._instrumented;}},chrome:function(g){var f=(g.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");f.pop();return f;},firefox:function(f){return f.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n");},opera11:function(l){var f="{anonymous}",m=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;var o=l.stacktrace.split("\n"),p=[];for(var h=0,k=o.length;h<k;h+=2){var j=m.exec(o[h]);if(j){var n=j[4]+":"+j[1]+":"+j[2];var g=j[3]||"global code";g=g.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,f);p.push(g+"@"+n+" -- "+o[h+1].replace(/^\s+/,""));}}return p;},opera10b:function(m){var l=/^(.*)@(.+):(\d+)$/;var h=m.stacktrace.split("\n"),g=[];for(var k=0,f=h.length;k<f;k++){var j=l.exec(h[k]);if(j){var n=j[1]?(j[1]+"()"):"global code";g.push(n+"@"+j[2]+":"+j[3]);}}return g;},opera10a:function(l){var f="{anonymous}",m=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var n=l.stacktrace.split("\n"),o=[];for(var h=0,k=n.length;h<k;h+=2){var j=m.exec(n[h]);if(j){var g=j[3]||f;o.push(g+"()@"+j[2]+":"+j[1]+" -- "+n[h+1].replace(/^\s+/,""));}}return o;},opera9:function(n){var j="{anonymous}",m=/Line (\d+).*script (?:in )?(\S+)/i;var h=n.message.split("\n"),g=[];for(var l=2,f=h.length;l<f;l+=2){var k=m.exec(h[l]);if(k){g.push(j+"()@"+k[2]+":"+k[1]+" -- "+h[l+1].replace(/^\s+/,""));}}return g;},other:function(k){var f="{anonymous}",j=/function\s*([\w\-$]+)?\s*\(/i,e=[],h,g,i=10;while(k&&k["arguments"]&&e.length<i){h=j.test(k.toString())?RegExp.$1||f:f;g=Array.prototype.slice.call(k["arguments"]||[]);e[e.length]=h+"("+this.stringifyArguments(g)+")";k=k.caller;}return e;},stringifyArguments:function(g){var f=[];var j=Array.prototype.slice;for(var h=0;h<g.length;++h){var e=g[h];if(e===d){f[h]="undefined";}else{if(e===null){f[h]="null";}else{if(e.constructor){if(e.constructor===Array){if(e.length<3){f[h]="["+this.stringifyArguments(e)+"]";}else{f[h]="["+this.stringifyArguments(j.call(e,0,1))+"..."+this.stringifyArguments(j.call(e,-1))+"]";}}else{if(e.constructor===Object){f[h]="#object";}else{if(e.constructor===Function){f[h]="#function";}else{if(e.constructor===String){f[h]='"'+e+'"';}else{if(e.constructor===Number){f[h]=e;}}}}}}}}}return f.join(",");},sourceCache:{},ajax:function(f){var g=this.createXMLHTTPObject();if(g){try{g.open("GET",f,false);g.send(null);return g.responseText;}catch(h){}}return"";},createXMLHTTPObject:function(){var h,f=[function(){return new XMLHttpRequest();},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Msxml3.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");}];for(var g=0;g<f.length;g++){try{h=f[g]();this.createXMLHTTPObject=f[g];return h;}catch(j){}}},isSameDomain:function(e){return typeof location!=="undefined"&&e.indexOf(location.hostname)!==-1;},getSource:function(e){if(!(e in this.sourceCache)){this.sourceCache[e]=this.ajax(e).split("\n");}return this.sourceCache[e];},guessAnonymousFunctions:function(p){for(var l=0;l<p.length;++l){var k=/\{anonymous\}\(.*\)@(.*)/,q=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,f=p[l],g=k.exec(f);if(g){var j=q.exec(g[1]);if(j){var h=j[1],e=j[2],o=j[3]||0;if(h&&this.isSameDomain(h)&&e){var n=this.guessAnonymousFunction(h,e,o);p[l]=f.replace("{anonymous}",n);}}}}return p;},guessAnonymousFunction:function(h,j,f){var g;try{g=this.findFunctionName(this.getSource(h),j);}catch(i){g="getSource failed with url: "+h+", exception: "+i.toString();}return g;},findFunctionName:function(e,j){var l=/function\s+([^(]*?)\s*\(([^)]*)\)/;var p=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/;var n=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/;var f="",q,o=Math.min(j,20),h,g;for(var k=0;k<o;++k){q=e[j-k-1];g=q.indexOf("//");if(g>=0){q=q.substr(0,g);}if(q){f=q+f;h=p.exec(f);if(h&&h[1]){return h[1];}h=l.exec(f);if(h&&h[1]){return h[1];}h=n.exec(f);if(h&&h[1]){return h[1];}}}return"(?)";}};(function(){var h='<?xml version="1.0" encoding="UTF-8"?><notice version="2.0"><api-key>{key}</api-key><notifier><name>airbrake_js</name><version>0.2.0</version><url>http://airbrake.io</url></notifier><error><class>{exception_class}</class><message>{exception_message}</message><backtrace>{backtrace_lines}</backtrace></error><request><url>{request_url}</url><component>{request_component}</component><action>{request_action}</action>{request}</request><server-environment><project-root>{project_root}</project-root><environment-name>{environment}</environment-name></server-environment></notice>',f,g,j,e;j={merge:(function(){function k(m,l,n){if(n.hasOwnProperty(m)){l[m]=n[m];}}return function(){var n=Array.prototype.slice.call(arguments),o,m,l={};while(o=n.shift()){for(m in o){k(m,l,o);}}return l;};})(),escape:function(k){return k.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/'/g,"&#39;").replace(/"/g,"&#34;");},trim:function(k){return k.toString().replace(/^\s+/,"").replace(/\s+$/,"");},substitute:function(m,l,k){return m.replace(/{([\w_.-]+)}/g,function(n,o){return(o in l)?l[o]:(k?"":n);});},processjQueryEventHandlerWrapping:function(){if(f.options.trackJQ===true){f.jQuery_fn_on_original=f.jQuery_fn_on_original||jQuery.fn.on;jQuery.fn.on=function(){var k=Array.prototype.slice.call(arguments),l=4;while((--l>-1)&&(typeof k[l]!=="function")){}if(l===-1){return f.jQuery_fn_on_original.apply(this,arguments);}k[l]=(function(m){return function(){try{m.apply(this,arguments);}catch(n){g.captureException(n);}};})(k[l]);return f.jQuery_fn_on_original.apply(this,k);};}else{(typeof f.jQuery_fn_on_original==="function")&&(jQuery.fn.on=f.jQuery_fn_on_original);}},isjQueryPresent:function(){return(typeof jQuery==="function")&&("fn" in jQuery)&&("jquery" in jQuery.fn)&&(jQuery.fn.jquery.indexOf("1.7")===0);},capitalizeFirstLetter:function(k){return k[0].toUpperCase()+k.slice(1);},generatePublicAPI:(function(){function k(m,n,o){return function(p){o[n][m]=p;};}function l(m,n,o){return function(p){return o[n][m];};}return function(m,r){var q=0,n=null,p="",o={};for(q=0;q<m.length;q+=1){n=m[q];switch(true){case (typeof n.variable!=="undefined")&&(typeof n.methodName==="undefined"):p=j.capitalizeFirstLetter(n.variable);o["set"+p]=k(n.variable,n.namespace,r);o["get"+p]=l(n.variable,n.namespace,r);break;case (typeof n.methodName!=="undefined")&&(typeof n.method!=="undefined"):o[n.methodName]=n.method;break;default:}}return o;};}())};f={xmlData:{environment:"environment"},options:{trackJQ:false,host:"api.airbrake.io",errorDefaults:{},guessFunctionName:false,requestType:"POST"}};e=[{variable:"environment",namespace:"xmlData"},{variable:"key",namespace:"xmlData"},{variable:"host",namespace:"options"},{variable:"errorDefaults",namespace:"options"},{variable:"guessFunctionName",namespace:"options"},{variable:"requestType",namespace:"options"},{methodName:"setTrackJQ",variable:"trackJQ",namespace:"options",method:(function(k){if(!j.isjQueryPresent()){throw Error("Please do not call 'Airbrake.setTrackJQ' if jQuery does't present");}k=!!k;if(f.options.trackJQ===k){return;}f.options.trackJQ=k;j.processjQueryEventHandlerWrapping();})},{methodName:"captureException",method:(function(k){new i().notify({message:k.message,stack:k.stack});})}];g=b.Airbrake=b.Hoptoad=j.generatePublicAPI(e,f);function i(){this.options=j.merge({},f.options);this.xmlData=j.merge(this.DEF_XML_DATA,f.xmlData);}i.prototype={constructor:i,VERSION:"0.2.0",ROOT:b.location.protocol+"//"+b.location.host,BACKTRACE_MATCHER:/^(.*)\@(.*)\:(\d+)$/,backtrace_filters:[/notifier\.js/],DEF_XML_DATA:{request:""},notify:(function(){function l(m,o){var n=a.createElement("iframe");n.style.display="none";n.src=m+"?data="+o;n.onload=function(){setTimeout(function(){a.body.removeChild(n);},0);};a.body.appendChild(n);}function k(m,o){var n=new XMLHttpRequest();n.open("POST",m,true);n.send(o);}return function(o){var n=this.generateXML(o),m="//"+this.options.host+"/notifier_api/v2/notices";switch(f.options.requestType){case"POST":k(m,n);break;case"GET":l(m,n);}};}()),generateXML:function(k){var r=this.xmlData,m,p,l,q,o=j.merge(this.options.errorDefaults,k),n=j.trim(j.escape(o.component||""));r.request_url=j.trim(j.escape((o.url||"")+location.hash));if(r.request_url||n){m=o["cgi-data"]||{};m.HTTP_USER_AGENT=navigator.userAgent;r.request+="<cgi-data>"+this.generateVariables(m)+"</cgi-data>";l=["params","session"];for(p=0;p<l.length;p++){q=l[p];if(o[q]){r.request+="<"+q+">"+this.generateVariables(o[q])+"</"+q+">";}}r.request_url=j.escape((o.url||"")+location.hash);r.request_action=j.escape(o.action||"");r.request_component=n;}r.project_root=this.ROOT;r.exception_class=j.escape(o.type||"Error");r.exception_message=j.escape(o.message||"Unknown error.");r.backtrace_lines=this.generateBacktrace(o).join("");return j.substitute(h,r,true);},generateBacktrace:function(l){var k=[],n,m,p,o;l=l||{};if(typeof l.stack!=="string"){try{(0)();}catch(q){l.stack=q.stack;}}o=this.getStackTrace(l);for(m=0;m<o.length;m++){p=o[m].match(this.BACKTRACE_MATCHER);if(p&&this.validBacktraceLine(o[m])){n=p[2].replace(this.ROOT,"[PROJECT_ROOT]");if(m===0&&p[2].match(a.location.href)){k.push('<line method="" file="internal: " number=""/>');}k.push('<line method="'+j.escape(p[1])+'" file="'+j.escape(n)+'" number="'+p[3]+'" />');}}return k;},getStackTrace:function(k){var l,m=c({e:k,guess:this.options.guessFunctionName});for(l=0;l<m.length;l++){if(m[l].match(/\:\d+$/)){continue;}if(m[l].indexOf("@")===-1){m[l]+="@unsupported.js";}m[l]+=":0";}return m;},validBacktraceLine:function(k){for(var l=0;l<this.backtrace_filters.length;l++){if(k.match(this.backtrace_filters[l])){return false;}}return true;},generateVariables:function(m){var l,k="";for(l in m){if(m.hasOwnProperty(l)){k+='<var key="'+j.escape(l)+'">'+j.escape(m[l])+"</var>";}}return k;}};})();})(window,document);
